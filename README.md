# gcar-dotnet-redis

Реализация алгоритма GCAR ограничения запросов (Rate Limiting), используя .NET (C#) и Redis.
Это пример использования для ограничения отправки запросов от сервиса к сервису - не для запросов пользователей.

# Архитектура проекта

Есть 2 сервиса:
- Producer
- Consumer

## Producer

Реализовано через `BackgroundService` в ASP.NET Core.
В отдельном потоке шлет запросы на [Consumer](#consumer) по HTTP. 
Между запросами выдерживается пауза в 10 мс.

Реализация есть в 2 вариантах:
- Локальная - бизнес-логика описана в коде C# 
- Скрипт - бизнес-логика описана в скрипте

## Consumer

Принимает запросы по ручке `POST /rate-limit`. 
При получении запроса делается попытка получения доступа у ограничителя запросов: 
- Если доступ получен, то счетчик успешных запросов инкрементируется и возвращается `200 OK`.
- Если доступ НЕ получен, то возвращается `429 TOO MANY REQUESTS`

Запускается в единственном экземпляре просто, чтобы было легче работать.

## Redis

Является хранилищем для даты последнего запроса. 
В реализации GCRA нужна только одна дата - штамп времени последнего запроса.
Используется время на Redis, для общей синхронизации - 
если на каждом узле будет использоваться свое время запроса, то может произойти рассинхронизация. 

## Grafana + Prometheus

Для отслеживания корректности работы используется Grafana и Prometheus.
`Consumer` содержит в себе счетчик принятых запросов, который читается Prometheus.
Grafana используется только в качестве визуализатора.

